// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============== [1. User ëª¨ë¸ ì •ì˜] ==============
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String
  password  String?  // '?'ëŠ” ì„ íƒì  í•„ë“œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

  // --- ê´€ê³„ ì„¤ì • ---
  // í•œ ëª…ì˜ ìœ ì €ëŠ” ì—¬ëŸ¬ ê°œì˜ Postë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  posts     Post[]
  likes     Like[] // [ì¶”ê°€] ì´ ìœ ì €ê°€ ëˆ„ë¥¸ 'ì¢‹ì•„ìš”' ëª©ë¡
  comments  Comment[] // [ì¶”ê°€] ì´ ìœ ì €ê°€ ì‘ì„±í•œ ëŒ“ê¸€ ëª©ë¡

  // --- [ìˆ˜ì •] íŒ”ë¡œìš° ê´€ê³„ í•„ë“œ ì¶”ê°€ ---
  // ë‚´ê°€ íŒ”ë¡œìš°í•˜ëŠ” ê´€ê³„ ëª©ë¡ (ë‚´ê°€ 'follower'ì¸ ê²½ìš°) ë‚´ê°€ ìƒëŒ€ë°©ì„ íŒ”ë¡œìš°í•¨ 
  following   Follows[] @relation("UserIsFollower")
  // ë‚˜ë¥¼ íŒ”ë¡œìš°í•˜ëŠ” ê´€ê³„ ëª©ë¡ (ë‚´ê°€ 'followed'ì¸ ê²½ìš°) ìƒëŒ€ë°©ì´ ë‚˜ë¥¼
  followers   Follows[] @relation("UserIsFollowed")
}

// ============== [Follows ëª¨ë¸ ìƒˆë¡œ ì¶”ê°€] ==============
model Follows {
// íŒ”ë¡œìš°ë¥¼ 'í•˜ëŠ”' ì‚¬ëŒ (íŒ”ë¡œì‰)
  followerId  Int
  follower    User @relation(name: "UserIsFollower", fields: [followerId], references: [id])

  // íŒ”ë¡œìš°ë¥¼ 'ë‹¹í•˜ëŠ”' ì‚¬ëŒ (íŒ”ë¡œì›Œ)
  followedId  Int
  followed    User @relation(name: "UserIsFollowed", fields: [followedId], references: [id])

  // ë³µí•© ê¸°ë³¸ í‚¤
  @@id([followerId, followedId])
}

// ============== [2. Post ëª¨ë¸ ì •ì˜] ==============
model Post {
  id        Int      @id @default(autoincrement())
  imageUrl  String
  caption   String

  // --- ê´€ê³„ ì„¤ì • ---
  // ì´ PostëŠ” í•œ ëª…ì˜ User(author)ì—ê²Œ ì†í•´ìˆìŠµë‹ˆë‹¤.
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int      // ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë  ì‘ì„±ìì˜ ID
  likes     Like[] // [ì¶”ê°€] ì´ ê²Œì‹œë¬¼ì´ ë°›ì€ 'ì¢‹ì•„ìš”' ëª©ë¡
  comments  Comment[] // [ì¶”ê°€] ì´ ê²Œì‹œë¬¼ì— ë‹¬ë¦° ëŒ“ê¸€ ëª©ë¡
}

// ============== [Like ëª¨ë¸ ìƒˆë¡œ ì¶”ê°€] ==============
model Like {
  id     Int @id @default(autoincrement())
  post   Post @relation(fields: [postId], references: [id])
  postId Int
  user   User @relation(fields: [userId], references: [id])
  userId Int

  @@unique([postId, userId]) // ğŸ‘ˆ ì´ í•œ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”!
}

// ============== [Comment ëª¨ë¸ ìƒˆë¡œ ì¶”ê°€] ==============
model Comment {
  id        Int      @id @default(autoincrement())
  text      String   // ëŒ“ê¸€ì˜ ì‹¤ì œ ë‚´ìš©

  // --- ê´€ê³„ ì„¤ì • ---
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int      // ëŒ“ê¸€ ì‘ì„±ì

  post      Post     @relation(fields: [postId], references: [id])
  postId    Int      // ëŒ“ê¸€ì´ ë‹¬ë¦° ê²Œì‹œë¬¼

  // --- íƒ€ì„ìŠ¤íƒ¬í”„ ---
  createdAt DateTime @default(now()) // ìƒì„± ì‹œê° (ìë™ ìƒì„±)
  updatedAt DateTime @updatedAt    // ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê° (ìë™ ì—…ë°ì´íŠ¸)
}